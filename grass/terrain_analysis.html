<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>GIS/MEA582: Geospatial Modeling and Analysis</title>

<link rel="shortcut icon" href=".././img/favicon.ico" />

<link href="../layout.css" rel="stylesheet" type="text/css" media="screen">
<link href="../style.css" rel="stylesheet" type="text/css" media="screen">

</head>

<body>

<div id="outercontainer">
<div id="container">

<header>
<div id="header-image">
    <h1>NCSU GIS/MEA582:<br>Geospatial Modeling and Analysis</h1>
</div>

<nav>
<ul class="nav">
<li><a href="../index.html">Syllabus</a></li>
<li><a href="../schedule.html">Schedule</a></li>
<li><a href="../logistics.html">Course logistics</a></li>
<li><a href="../lectures.html">Lectures</a></li>
<li><a href="../assignments.html">Assignments</a></li>
<li><a href="../projects.html">Projects</a></li>
</ul>
</nav>

</header>

<main>

<!-- This is a generated file. Do not edit. -->
<div style="background-color: #FA8; border: 4px solid #F00; padding: 10px;"><p>This is an unmaintained course material, please see current material at:<ul><li><a href="http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/">http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/</a></li><li><a href="http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/grass/terrain_analysis.html">http://ncsu-geoforall-lab.github.io/geospatial-modeling-course/grass/terrain_analysis.html</a> (likely URL)</li></ul></div>
<h2>Geomorphometry II: Spatial and Temporal Terrain Analysis</h2>
<p>
Resources: <a href="http://grass.osgeo.org/grass70/manuals/index.html">
GRASS GIS overview and manual</a>,
<a href="http://www.grassbook.org/">GRASSbook</a>.

<p>
Download Mapset and color tables:
<ul>
<li> Download <a href="http://courses.ncsu.edu/mea582/common/media/01/NagsHead_series.zip">
NagsHead time series</a> and copy it into your nc_spm_08_grass7 Location
(it should be the same level directory as PERMANENT).
Do not let your unzipping program create additional level directory with the same name!
If you are not sure about GRASS GIS Database structure read about it in
<a href="http://grass.osgeo.org/grass71/manuals/grass_database.html">the manual</a>.
<li><a href="data/stddev_color.txt">stddev_color.txt</a></li>
<li><a href="data/regrslope_color.txt">regrslope_color.txt</a></li>
</ul>

<h3>Start GRASS GIS</h3>
Start GRASS - click on GRASS icon or type<br>

<pre><code>grass70
</code></pre>

<p>
In startup pannel set <b>GIS Data Directory</b> to path to datasets,
for example on MS Windows, <code>C:\Users\myname\grassdata</code>.<br>
For <b>Project location</b> select nc_spm_08_grass7 (North Carolina, State Plane, meters) and
for <b>Accessible mapset</b> create a new mapset (called e.g. HW_terrain_analysis).<br>
Click <b>Start GRASS</b>.

<p>
Change working directory:<br>
<em>Settings</em> > <em>GRASS working environment</em> > <em>Change working directory</em> > select/create any directory<br>
or type <code>cd</code> (stands for change directory) into the GUI command console and hit Enter:
<pre><code>cd
</code></pre>
Download all text files (see above)
to the selected directory. Now you can use the commands from the assignment requiring the text file
without the need to specify the full path to the file.


<h3>Compute basic topographic parameters: slope and aspect</h3>
<!-- p. 142-142<br> -->

<pre><code>g.region raster=elevation -p
r.slope.aspect elevation=elevation slope=myslope aspect=myaspect
</code></pre>

<p>
Display resulting maps with legend using GUI.

<pre><code>d.rast myslope
d.legend myslope at=2,40,2,6
d.out.file myslope
d.rast myaspect
d.legend myaspect at=2,40,2,6
d.out.file myaspect
</code></pre>

<p>
<!-- d.rast profcurv
d.legend profcurv at=2,40,2,6
d.out.file profcurv
d.rast tancurv
d.legend tancurv at=2,40,2,6
d.out.file tancurv
<font color="#000066">
# use nviz to explore relation between terrain shape and curvatures
# zoom in to show features with concave and convex shape
</font>
nviz elevation color=profcurv -->
Show impact of integer values in meters on slope and aspect pattern.<br>
Compute integer DEM and derive its slope and aspect.<br>
Use GUI to display the histogram: in <em>Map Display</em> > <em>Analyze</em> > <em>Create histogram</em>:

<pre><code>r.mapcalc "elev_int = int(elevation)"
r.slope.aspect elev_int aspect=aspect_int_10m slope=slope_int_10m
<!-- d.erase -->
d.histogram slope_int_10m
d.histogram myslope
d.histogram aspect_int_10m
d.histogram myaspect
<!-- d.erase -->
d.rast myslope
</code></pre>

<p>
Zoom into SW area of the current region (relatively flat area near large interchange).<br>
<span class="question">Can you explain the difference in slope maps derived from integer (m vertical resolution)
and floating point (mm vertical resolution) DEMs?</span>

<pre><code>d.rast slope_int_10m
d.out.file slope_int
</code></pre>

<h3>Compute slope along road</h3>
Compute slope of a bus route. First extract values from slope map layer:
<pre><code>g.region raster=elevation res=20
v.to.rast input=busroute11 type=line output=busroute11 use=dir
r.mapcalc "route_slope = if(busroute11, myslope)"
</pre></code>

Then compute slope in the direction of the route:
<pre><code>v.to.rast input=busroute11 type=line output=busroute11_dir use=dir
r.mapcalc "route_slope_dir = abs(atan(tan(myslope) * cos(myaspect - busroute11_dir)))"
r.colors map=route_slope,route_slope_dir color=slope
</pre></code>

Display, zoom if necessary, and compute univariate statistics and comment on the difference of two results.
<pre><code>r.univar route_slope
r.univar route_slope_dir

d.shade shade=elevation_shade color=myslope brighten=20
r.contour input=elevation output=contours step=2
d.vect contours
d.rast route_slope
d.out.file route_slope
d.rast route_slope_dir
d.out.file route_slope_dir
</pre></code>

<h3>Curvatures</h3>
<p>
<!-- # further zoom into a selected area until you see grid cells
# display gradient vector
# in GUI GIS Manager click the icon with arrows
</font>
d.erase
d.rast elevation
d.zoom
d.rast.arrow aspect arrow_col=blue magnitude=slope scale=2 -->
<!-- p.248-249<br> -->
Compute slope, aspect and curvatures simultaneously with interpolation.<br>
You can do the examples below for the bare earth data only (first example),<br>
multiple return example is optional (if you are curious how it differs from BE).

<pre><code>g.region rural_1m  -p
v.surf.rst elev_lid792_bepts elevation=elev_lid_1m aspect=asp_lid_1m pcurvature=pc_lid_1m tcurvature=tc_lid_1m npmin=120 segmax=25
v.surf.rst elev_lidrural_mrpts elevation=elev_lidmr_1m aspect=asp_lidmr_1m pcurvature=pc_lidmr_1m tcurvature=tc_lidmr_1m npmin=120 segmax=25 tension=300 smooth=1.
</code></pre>

<p>
Display the results as 2D images or in 3D view.<br>
For 3D view, switch off everything except for elevation surface that you want to view.<br>
Drape topographic parameters raster maps over DEMs as color.

<pre><code><!-- d.erase -->
d.rast elev_lid_1m
d.rast pc_lid_1m
d.out.file profcurvature1
d.rast elev_lidmr_1m
d.rast pc_lidmr_1m
</code></pre>

<p>
The curvature maps reflect survey pattern rather than topographic features.<br>
So we lower the tension and increase the smoothing.<br>
You can use multiple displays to compare the results side-by-side.

<pre><code>g.region rural_1m  -p
v.surf.rst elev_lid792_bepts elevation=elev_lidt15_1m aspect=asp_lidt15_1m pcurvature=pc_lidt15_1m tcurvature=tc_lidt15_1m npmin=120 segmax=25 tension=15 smooth=1.
v.surf.rst elev_lidrural_mrpts elevation=elev_lidmrt15_1m aspect=asp_lidmrt15_1m pcurvature=pc_lidmrt15_1m tcurvature=tc_lidmrt15_1m npmin=120 segmax=25 tension=15 smooth=1.
<!-- d.erase -->
d.rast elev_lidt15_1m
d.rast pc_lidt15_1m
d.out.file profcurvature2
d.rast tc_lidt15_1m
d.rast elev_lidmrt15_1m
d.rast pc_lidmrt15_1m
</code></pre>

<h3>Landforms</h3>

<!-- p. 150<br> -->
Extract landforms at different levels of detail by adjusting the size of moving window.<br>
Set rural subregion at 1m resolution,
compute landforms using 9m and 45m neighborhood: read the manual to learn more.<br>
<span class="question">Explain types of landforms and the role of the neighborhood size.</span>

<pre><code>g.region rural_1m -p
r.param.scale elev_lid792_1m output=feature9c_1m size=9  method=feature
r.param.scale elev_lid792_1m output=feature45c_1m size=45 method=feature
</code></pre>

<p>
Display with legend, save images for the report.<br>
Optionally display the feature maps draped over elev_lid792_1m as color.

<pre><code>d.rast feature9c_1m
d.legend feature9c_1m at=2,20,2,6
d.rast feature45c_1m
d.legend feature45c_1m at=2,20,2,6
d.vect elev_lid792_cont1m color=brown
<!--nviz elev_lid792_1m color=feature9c_1m nviz elev_lid792_1m color=feature45c_1m-->
</code></pre>

<h3>Raster time series analysis</h3>

For this exercise we will use NagsHead_series Mapset you downloaded.<br>
You have to first make the mapset accessible.<br>
In GUI: menu <em> Settings</em> -> <em>GRASS working environment</em> -> <em>Mapset access</em>
or by using a command:

<pre><code>g.mapsets operation=add mapset=NagsHead_series
</code></pre>

If you don't see the mapset, make sure you downloaded it and unzipped it correctly.

<p>
Run the series analysis and explain the results:<br>
<span class="question">Which maps are core and envelope? 
Which landforms have high standard deviation and what does it mean?</span>

<pre><code>g.region raster=NH_2008_1m -p
<!-- d.erase -->
d.rast NH_2008_1m
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_min method=minimum
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_max method=maximum
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_mintime method=min_raster
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_maxtime method=max_raster
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_range method=range
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_avg method=average
r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_stddev method=stddev
<!--r.series NH_1999_1m,NH_2001_1m,NH_2004_1m,NH_2005_1m,NH_2007_1m,NH_2008_1m out=NH_9908_slope method=slope-->
r.colors NH_9908_stddev rules=stddev_color.txt
<!--r.colors NH_9908_slope rules=regrslope_color.txt-->
d.rast NH_9908_stddev
d.rast NH_9908_range
</code></pre>

<p>
Use cutting plane in 3D view to show the core and envelope.<br>
Add constant elevation plane at -1m for reference,
set zexag somewhere 3-5 (the default is too high).<br>
Assign surfaces constant color, use top or bottom surface for crossection color.<br>
When using top for color, lower the light source to make
top surface dark and highlight the crossection.


<!-- # optional example: topo parameters from contours
nviz NH_9908_min,NH_9908_max
g.region rural_1m res=2 -p
v.surf.rst elev_lid792_cont1m zcol=level dmin=3 npmin=250 \
  el=elev_rstcontd_2mt slo=slp_rstcontd_2m pc=pc_rstcontd_2m
d.erase
d.rast slp_rstcontd_2m
d.rast pc_rstcontd_2m
d.vect elev_lid792_cont1m
g.region rural_1m res=2 -p
v.surf.rst elev_lid792_cont1m zcol=level el=elev_rstct10_2m \
   slo=slp_rstct10_2m asp=asp_rstct10_2m pcur=pc_rstct10_2m \
   tcu=tc_rstct10_2m ten=10 dmin=3 npmin=250
d.rast pc_rstct10_2m
d.vect elev_lid792_cont1m
d.rast tc_rstct10_2m
# if available, use v.generalize to reduce number of points in elev_lid792_cont1m
# and interpolate
<font color="#000066">
# optional
# p. 132
# compute cut and fill for 4m deep excavation to build a facility
# set the region, display facility on top of orthophoto
# set MASK to facility map and find min elevation
</font>
g.region rural_1m -p
d.erase
d.rast ortho_2001_t792_1m
d.rast facility
r.mask facility
r.univar elevation
<font color="#000066">
# [...]
# minimum: 123.521
# bottom of 4m excavation will be 123.52-4=119.52m
</font>
r.mapcalc "excavation = elevation-119.52"
d.rast excavation
r.univar excavation
<font color="#000066">
# [...]
# minimum: 4.00057
# maximum: 9.50554
</font>
r.volume excavation
<font color="#000066">
# REMOVE MASK! so that it does not affect your future work
</font>
g.remove rast=MASK
# or
r.mask -r
<font color="#000066">
# optional: compute polar histogram if available
# can you explain the difference in polar histograms?
</font>
d.polar aspect_int_10m
d.polar myaspect
-->

</main>

<footer>

<nav>
<ul>
<li><a class="term-changes" href="https://moodle-courses1617.wolfware.ncsu.edu/course/view.php?id=2299">Moodle site</a></li>
<li><a href="http://help.ncsu.edu/">Computing Help</a></li>
<li><a href="http://geospatial.ncsu.edu/">GIST Home</a></li>
<li><a href="http://www.ncsu.edu/policies/prr-disclaimer.php">Disclaimer</a></li>
<li><a href="http://oit.ncsu.edu/itaccess">Accessibility</a></li>
<!--
<li><a href="https://github.com/ncsu-osgeorel/grass-intro-workshop" target='_blank'>GitHub repository</a></li>
-->
<li>
    <a href="https://github.com/ncsu-osgeorel/geospatial-modeling-course" title="Source code for web pages on GitHub">
        <img src="../img/github_logo.png" alt="GitHub Octocat logo">
    </a>
</li>
<li title="Copyright and license (not applicable to linked materials)">
    &copy; 2016
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
    <a href="http://geospatial.ncsu.edu/osgeorel/">NCSU OSGeoREL</a>
</li>
</ul>
</nav>

</footer>

</div>
</div>

</body>
</html>

